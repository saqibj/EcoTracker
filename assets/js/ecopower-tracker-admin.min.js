!function(e){"use strict";const t={init:function(){this.bindEvents(),this.initializeDataTables(),this.initializeDatePickers(),this.initializeCharts()},bindEvents:function(){e(".ecopower-tracker-delete").on("click",this.handleProjectDelete),e("#ecopower-tracker-form").on("submit",this.handleFormSubmit),e("#ecopower-tracker-csv").on("change",this.handleCsvPreview),e(".ecopower-tracker-filter").on("change",this.handleFilterChange),e(".ecopower-tracker-refresh").on("click",this.refreshData)},initializeDataTables:function(){e.fn.DataTable&&e(".ecopower-tracker-table").length&&e(".ecopower-tracker-table").DataTable({pageLength:25,responsive:!0,dom:"Bfrtip",buttons:["copy","csv","excel","pdf","print"],language:{search:ecoPowerTrackerAdmin.i18n.search,lengthMenu:ecoPowerTrackerAdmin.i18n.lengthMenu,info:ecoPowerTrackerAdmin.i18n.info}})},initializeDatePickers:function(){e.fn.datepicker&&e(".ecopower-tracker-date").length&&e(".ecopower-tracker-date").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0})},initializeCharts:function(){"undefined"!=typeof Chart&&e("#powerGenerationChart").length&&this.loadChartData()},handleProjectDelete:function(t){if(t.preventDefault(),!confirm(ecoPowerTrackerAdmin.i18n.confirmDelete))return;const r=e(this),o=r.data("project-id");e.ajax({url:ecoPowerTrackerAdmin.ajaxUrl,type:"POST",data:{action:"ecopower_tracker_delete_project",nonce:ecoPowerTrackerAdmin.nonce,project_id:o},beforeSend:function(){r.prop("disabled",!0)},success:function(e){e.success?r.closest("tr").fadeOut(function(){e(this).remove()}):alert(e.data.message||ecoPowerTrackerAdmin.i18n.error)},error:function(){alert(ecoPowerTrackerAdmin.i18n.error)},complete:function(){r.prop("disabled",!1)}})},handleFormSubmit:function(t){t.preventDefault();const r=e(this),o=r.find('[type="submit"]');e.ajax({url:ecoPowerTrackerAdmin.ajaxUrl,type:"POST",data:new FormData(this),processData:!1,contentType:!1,beforeSend:function(){o.prop("disabled",!0)},success:function(e){e.success?window.location.href=e.data.redirect:alert(e.data.message||ecoPowerTrackerAdmin.i18n.error)},error:function(){alert(ecoPowerTrackerAdmin.i18n.error)},complete:function(){o.prop("disabled",!1)}})},handleCsvPreview:function(e){const r=e.target.files[0];if(!r)return;const o=new FileReader;o.onload=function(e){const r=e.target.result;t.displayCsvPreview(r)},o.readAsText(r)},displayCsvPreview:function(e){const t=e.split("\n"),r=t[0].split(",");let o='<table class="wp-list-table widefat fixed striped">';o+="<thead><tr>",r.forEach(e=>{o+=`<th>${e.trim()}</th>`}),o+="</tr></thead><tbody>";for(let e=1;e<Math.min(t.length,6);e++){const r=t[e].split(",");o+="<tr>",r.forEach(e=>{o+=`<td>${e.trim()}</td>`}),o+="</tr>"}o+="</tbody></table>",e("#csv-preview").html(o)},handleFilterChange:function(){const r={};e(".ecopower-tracker-filter").each(function(){const t=e(this).val();t&&(r[e(this).data("filter")]=t)}),t.refreshData(r)},refreshData:function(r={}){const o=e(".ecopower-tracker-content");e.ajax({url:ecoPowerTrackerAdmin.ajaxUrl,type:"POST",data:{action:"ecopower_tracker_refresh_data",nonce:ecoPowerTrackerAdmin.nonce,filters:r},beforeSend:function(){o.addClass("loading")},success:function(e){e.success?(o.html(e.data.html),t.initializeDataTables(),t.initializeCharts()):alert(e.data.message||ecoPowerTrackerAdmin.i18n.error)},error:function(){alert(ecoPowerTrackerAdmin.i18n.error)},complete:function(){o.removeClass("loading")}})},loadChartData:function(){e.ajax({url:ecoPowerTrackerAdmin.ajaxUrl,type:"POST",data:{action:"ecopower_tracker_chart_data",nonce:ecoPowerTrackerAdmin.nonce},success:function(e){e.success&&t.renderChart(e.data)}})},renderChart:function(t){new Chart(e("#powerGenerationChart"),{type:"bar",data:t,options:{responsive:!0,scales:{y:{beginAtZero:!0}}}})}};e(document).ready(function(){t.init()})}(jQuery),function(e){"use strict";e(function(){e(".datepicker").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearRange:"2000:2030",showButtonPanel:!0,showAnim:"fadeIn"}),e(".ecopower-tracker-admin").on("click",".button-link-delete",function(t){return!!confirm(ecoPowerTracker.strings.confirmDelete)||(t.preventDefault(),!1)}),e("form.ecopower-tracker-form").on("submit",function(t){var r=!0,o=e(this);return o.find("[required]").each(function(){var t=e(this);t.val().trim()?(t.removeClass("error"),t.next(".error-message").remove()):(t.addClass("error"),r=!1,t.next(".error-message").length||t.after('<span class="error-message" style="color:#dc3232;display:block;margin:5px 0 0;">'+ecoPowerTracker.strings.requiredField+"</span>"))}),o.find('input[type="number"]').each(function(){var t=e(this),o=parseFloat(t.attr("min")),n=parseFloat(t.attr("max")),a=parseFloat(t.val());isNaN(o)||a>=o?isNaN(n)||a<=n?(t.removeClass("error"),t.next(".error-message").remove()):(t.addClass("error"),r=!1,t.next(".error-message").remove(),t.after('<span class="error-message" style="color:#dc3232;display:block;margin:5px 0 0;">'+ecoPowerTracker.strings.maxValue.replace("%s",n)+"</span>")):(t.addClass("error"),r=!1,t.next(".error-message").remove(),t.after('<span class="error-message" style="color:#dc3232;display:block;margin:5px 0 0;">'+ecoPowerTracker.strings.minValue.replace("%s",o)+"</span>"))}),!!r||(t.preventDefault(),e(".error").first().length&&e("html, body").animate({scrollTop:e(".error").first().offset().top-100},500),!1)}),e("form.ecopower-tracker-form").on("input","[required]",function(){var t=e(this);t.val().trim()&&(t.removeClass("error"),t.next(".error-message").remove())})}),e.datepicker.regional[""]{closeText:"Close",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"yy-mm-dd",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},e.datepicker.setDefaults(e.datepicker.regional[""])}(jQuery);
